//- views/pay.pug
extends layout

block pageTitle
  | Bezahlen

block headerRight
  a.btn.small(href="/") ZurÃ¼ck

block content
  - const secondCoffee = locals.secondCoffee;
  - const beans = locals.beans;

  .app
    // Dynamisches Grid: 2 Spalten wenn zweite Sorte aktiv, sonst 1 Spalte
    .grid(style=`display:grid; gap:20px; grid-template-columns:${secondCoffee && drink.recipe.coffee > 0 ? '1fr 1fr' : '1fr'}`)

      // LINKS: PAYMENT
      .panel.card.fill
        h2
          | #{drink.name} â€“ 
          span#pay-title-price #{drink.price.toFixed(2)} #{status.currency}

        .line
          label Guthaben:
          span#pay-inserted= `${(status.payment.inserted||0).toFixed(2)} ${status.currency}`

        .line
          label Restbetrag:
          span#pay-remain 0.00 #{status.currency}

        .line
          label Retourgeld:
          span#pay-change= `${(status.payment.change||0).toFixed(2)} ${status.currency}`

        p#pay-info HINWEIS: Bitte Zahlung oder Tasse prÃ¼fen.

        .cup-illustration#cup-missing.hidden
          .cup-icon ðŸ¥¤
          h3 Bitte Tasse hinstellen

      // RECHTS: BOHNENWAHL (nur bei Kaffee & 2. Sorte aktiv)
      if secondCoffee && drink.recipe.coffee > 0
        .card
          h3(style="margin-top:0") Kaffeesorte wÃ¤hlen
          #bean-section.card(style="margin-top:16px;")
            .bean-grid
              each b, i in beans
                label.bean-card(class=i===0 ? 'checked' : '')
                  input(type="radio", name="bean", value=b.id, checked=(i===0))
                  .bean-icon â˜•
                  .bean-meta
                    .bean-name #{b.name}
                    if b.priceMod && b.priceMod > 0
                      .bean-extra +#{b.priceMod.toFixed(2)} #{status.currency}
                    .bean-warning.hidden Zu wenig Bestand

  script.
    window.__PAY_CONTEXT__ = {
      drinkId: "!{drink.id}",
      name: "!{drink.name}",
      basePrice: !{drink.price},
      currency: "!{status.currency}",
      bean: "!{bean || ''}",
      secondCoffee: !{secondCoffee},
      recipeCoffee: !{drink.recipe.coffee}
    };