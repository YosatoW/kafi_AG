//- views/pay.pug
extends layout

block pageTitle 
  | Bezahlen

block headerRight
  a.btn.small(href="/") ZurÃ¼ck

block content
  - const secondCoffee = locals.secondCoffee;
  - const beans = locals.beans;

  .app
    .grid(style=`display:grid; gap:20px; grid-template-columns:${secondCoffee && drink.recipe.coffee > 0 ? '1fr 1fr' : '1fr'}`)

      // LINKER BLOCK: PAYMENT
      .panel.card.fill
        h2
          | #{drink.name} â€“ 
          span#pay-title-price #{drink.price.toFixed(2)} #{status.currency}

        .line
          label Guthaben:
          span#pay-inserted= `${(status.payment.inserted||0).toFixed(2)} ${status.currency}`

        .line
          label Restbetrag:
          span#pay-remain 0.00 #{status.currency}

        .line
          label Retourgeld:
          span#pay-change= `${(status.payment.change||0).toFixed(2)} ${status.currency}`

        p#pay-info Hinweis: Die Zubereitung startet automatisch, wenn der volle Betrag bezahlt ist und eine Tasse erkannt wird.

        .cup-illustration#cup-missing.hidden
          .cup-icon ðŸ¥¤
          h3 Bitte Tasse hinstellen

      if secondCoffee && drink.recipe.coffee > 0

        .card
          h3(style="margin-top:0") Kaffeesorte wÃ¤hlen
          #bean-section.card(style="margin-top:16px;")
            // Immer sichtbar:
            p#bean-prompt(style="margin:0 0 8px 0; opacity:.85")
              | Bitte Bohne wÃ¤hlen.

            // Nur in speziellen FÃ¤llen sichtbar (per JS):
            p#auto-hint.hidden(style="margin:0 0 12px 0; opacity:.85")
              | Ohne Auswahl wird automatisch mit 
              strong #{beans[0].name}
              |  in 
              span#auto-timer 3
              |  Sekunden gestartet.

          .bean-grid
            each b, i in beans
              label.bean-card(class=i===0 ? 'checked' : '')
                input(type="radio", name="bean", value=b.id, checked=(i===0))
                .bean-icon â˜•
                .bean-meta
                  .bean-name #{b.name}
                  if b.priceMod && b.priceMod > 0
                    .bean-extra +#{b.priceMod.toFixed(2)} #{status.currency}
          
          .row(style="justify-content:flex-end; grid-template-columns:auto; margin-top:8px;")
            button.btn.primary#manual-continue.hidden Weiter


    script.
      window.__PAY_CONTEXT__ = {
        drinkId: "!{drink.id}",
        basePrice: !{drink.price},
        currency: "!{status.currency}",
        bean: "!{bean || ''}",
        secondCoffee: !{secondCoffee},
        recipeCoffee: !{drink.recipe.coffee}
      };

